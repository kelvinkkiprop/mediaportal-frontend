import{a as $,b as I,c as G,d as J,e as K,f as Q,g as X}from"./chunk-UBE3M7BL.js";import{a as _}from"./chunk-N4ALU6JD.js";import{$ as d,Aa as q,C as p,Ea as b,F as u,Fa as Y,G as F,H as M,K as E,N as h,O as R,P as O,Q as a,R as s,S as f,T as z,U as C,V as T,_ as W,ba as P,c as B,ca as H,da as V,ea as j,g as y,o as N,p as S,r as U,ra as A,ta as x,u as c,v as m,va as L}from"./chunk-ARG6DOEE.js";var g=class o{constructor(t,e){this.mAppContextService=t;this.http=e}createItem(t){let e=`${_.base_url}/upload`;return this.http.post(e,t)}initUpload(t,e){let i=`${_.base_url}/upload/init`;return this.http.post(i,{filename:t,title:e})}uploadChunk(t,e,i){let r=new FormData;r.append("uploadId",t),r.append("chunkIndex",e.toString()),r.append("file",i,`chunk_${e}`);let n=`${_.base_url}/upload/chunk`;return this.http.post(n,r,{reportProgress:!0,observe:"events"})}completeUpload(t,e,i,r){let n=`${_.base_url}/upload/complete`;return this.http.post(n,{uploadId:t,totalChunks:e,title:i,description:r})}static \u0275fac=function(e){return new(e||o)(U(Y),U(L))};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})};function re(o,t){o&1&&(a(0,"p"),d(1,"Drag & drop a video here, or click to select"),s())}function ae(o,t){if(o&1&&(a(0,"p"),d(1),s()),o&2){let e=T();p(),P("Selected: ",e.selectedFile.name,"")}}function le(o,t){if(o&1&&(a(0,"div"),d(1),a(2,"div",9),f(3,"div",10),s()()),o&2){let e=T();p(),P(" Progress: ",e.progress,"% "),p(2),R("width",e.progress,"%")}}var v=class o{constructor(t){this.uploadService=t}selectedFile=null;title="";description="";progress=0;isDragging=!1;onFileSelected(t){this.selectedFile=t.target.files[0]}onDragOver(t){t.preventDefault(),this.isDragging=!0}onDragLeave(t){t.preventDefault(),this.isDragging=!1}onDrop(t){t.preventDefault(),this.isDragging=!1,t.dataTransfer?.files.length&&(this.selectedFile=t.dataTransfer.files[0])}upload(){return B(this,null,function*(){if(!this.selectedFile)return;let t=5*1024*1024,e=Math.ceil(this.selectedFile.size/t),r=(yield y(this.uploadService.initUpload(this.selectedFile.name,this.title))).uploadId;for(let n=0;n<e;n++){let l=n*t,te=Math.min(l+t,this.selectedFile.size),ie=this.selectedFile.slice(l,te);yield y(this.uploadService.uploadChunk(r,n,ie).pipe()),this.progress=Math.round((n+1)/e*100)}yield y(this.uploadService.completeUpload(r,e,this.title,this.description)),alert("Upload complete!")})}static \u0275fac=function(e){return new(e||o)(u(g))};static \u0275cmp=F({type:o,selectors:[["app-create"]],hostBindings:function(e,i){e&1&&C("dragover",function(n){return i.onDragOver(n)})("dragleave",function(n){return i.onDragLeave(n)})("drop",function(n){return i.onDrop(n)})},standalone:!1,decls:15,vars:8,consts:[["fileInput",""],[1,"mb-3"],[1,"dropzone"],[4,"ngIf"],["type","file","hidden","","accept","video/*",3,"change"],[1,"btn","btn-success","btn-sm",3,"click"],["type","text","placeholder","Title",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Description",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"progress-bar"],[1,"progress-fill"]],template:function(e,i){if(e&1){let r=z();a(0,"div",1)(1,"div",2),E(2,re,2,0,"p",3)(3,ae,2,1,"p",3),a(4,"input",4,0),C("change",function(l){return c(r),m(i.onFileSelected(l))}),s(),a(6,"button",5),C("click",function(){c(r);let l=W(5);return m(l.click())}),d(7,"Choose File"),s()()(),a(8,"div",1)(9,"input",6),j("ngModelChange",function(l){return c(r),V(i.title,l)||(i.title=l),m(l)}),s()(),a(10,"div",1)(11,"textarea",7),j("ngModelChange",function(l){return c(r),V(i.description,l)||(i.description=l),m(l)}),s()(),a(12,"button",8),C("click",function(){return c(r),m(i.upload())}),d(13,"Upload"),s(),E(14,le,4,3,"div",3)}e&2&&(p(),O("dragging",i.isDragging),p(),h("ngIf",!i.selectedFile),p(),h("ngIf",i.selectedFile),p(6),H("ngModel",i.title),p(2),H("ngModel",i.description),p(),h("disabled",!i.selectedFile),p(2),h("ngIf",i.progress>0))},dependencies:[A,$,G,J],styles:[".dropzone[_ngcontent-%COMP%]{border:2px dashed #bbb;border-radius:8px;padding:40px;text-align:center;cursor:pointer;transition:.2s}.dropzone.dragging[_ngcontent-%COMP%]{background-color:#eef6ff;border-color:#3b82f6}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background:#eee;border-radius:4px;margin-top:10px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;transition:width .3s}"]})};var D=class o{constructor(t,e,i){this.mUploadService=t;this.router=e;this.fb=i;this.itemForm=this.fb.group({title:["",I.required],description:["",I.required],video:["",I.required]})}mFile;itemForm;mProgress=!1;onSubmit(t){let e=new FormData;e.append("title",t.title),e.append("description",t.description),e.append("file",this.mFile,this.mFile.title),this.mUploadService.createItem(e).subscribe({next:i=>{console.log(i)},error:i=>{}})}onFileChange(t){if(t.target.value){let e=t.target.files[0];if(console.log(e),e.size>1e8){this.mFile="";return}this.mFile=e}}static \u0275fac=function(e){return new(e||o)(u(g),u(q),u(K))};static \u0275cmp=F({type:o,selectors:[["app-index"]],standalone:!1,decls:13,vars:0,consts:[[1,"app-content-header"],[1,"app-content"],[1,"container-fluid"],[1,"row"],[1,"col-lg-12","col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-tools"],[1,"card-body"]],template:function(e,i){e&1&&(a(0,"section"),f(1,"div",0),a(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),d(9," Upload Media "),s(),f(10,"div",8),s(),a(11,"div",9),f(12,"app-create"),s()()()()()()())},dependencies:[v],encapsulation:2})};var pe=[{path:"",redirectTo:"index",pathMatch:"full"},{path:"index",component:D,data:{title:"Index"}},{path:"create",component:v,data:{title:"Create"}}],k=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=M({type:o});static \u0275inj=S({imports:[x,b.forChild(pe),b]})};var ee=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=M({type:o});static \u0275inj=S({imports:[x,b,Q,X,k]})};export{ee as UploadModule};
